{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport { PermissionStatus } from \"./Permissions.types\";\n\nfunction _getUserMedia(constraints) {\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    return navigator.mediaDevices.getUserMedia(constraints);\n  }\n\n  var getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || function () {\n    var error = new Error('Permission unimplemented');\n    error.code = 0;\n    error.name = 'NotAllowedError';\n    throw error;\n  };\n\n  return new Promise(function (resolve, reject) {\n    getUserMedia.call(navigator, constraints, resolve, reject);\n  });\n}\n\nfunction askForMediaPermissionAsync(_x) {\n  return _askForMediaPermissionAsync.apply(this, arguments);\n}\n\nfunction _askForMediaPermissionAsync() {\n  _askForMediaPermissionAsync = _asyncToGenerator(function* (options) {\n    try {\n      yield _getUserMedia(options);\n      return {\n        status: PermissionStatus.GRANTED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: true\n      };\n    } catch (_ref) {\n      var message = _ref.message;\n\n      if (message === 'Permission dismissed') {\n        return {\n          status: PermissionStatus.UNDETERMINED,\n          expires: 'never',\n          canAskAgain: true,\n          granted: false\n        };\n      } else {\n        return {\n          status: PermissionStatus.DENIED,\n          expires: 'never',\n          canAskAgain: true,\n          granted: false\n        };\n      }\n    }\n  });\n  return _askForMediaPermissionAsync.apply(this, arguments);\n}\n\nfunction askForMicrophonePermissionAsync() {\n  return _askForMicrophonePermissionAsync.apply(this, arguments);\n}\n\nfunction _askForMicrophonePermissionAsync() {\n  _askForMicrophonePermissionAsync = _asyncToGenerator(function* () {\n    return yield askForMediaPermissionAsync({\n      audio: true\n    });\n  });\n  return _askForMicrophonePermissionAsync.apply(this, arguments);\n}\n\nfunction askForCameraPermissionAsync() {\n  return _askForCameraPermissionAsync.apply(this, arguments);\n}\n\nfunction _askForCameraPermissionAsync() {\n  _askForCameraPermissionAsync = _asyncToGenerator(function* () {\n    return yield askForMediaPermissionAsync({\n      video: true\n    });\n  });\n  return _askForCameraPermissionAsync.apply(this, arguments);\n}\n\nfunction askForLocationPermissionAsync() {\n  return _askForLocationPermissionAsync.apply(this, arguments);\n}\n\nfunction _askForLocationPermissionAsync() {\n  _askForLocationPermissionAsync = _asyncToGenerator(function* () {\n    return new Promise(function (resolve) {\n      navigator.geolocation.getCurrentPosition(function () {\n        return resolve({\n          status: PermissionStatus.GRANTED,\n          expires: 'never',\n          canAskAgain: true,\n          granted: true\n        });\n      }, function (_ref2) {\n        var code = _ref2.code;\n\n        if (code === 1) {\n          resolve({\n            status: PermissionStatus.DENIED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false\n          });\n        } else {\n          resolve({\n            status: PermissionStatus.UNDETERMINED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false\n          });\n        }\n      });\n    });\n  });\n  return _askForLocationPermissionAsync.apply(this, arguments);\n}\n\nfunction getPermissionWithQueryAsync(_x2) {\n  return _getPermissionWithQueryAsync.apply(this, arguments);\n}\n\nfunction _getPermissionWithQueryAsync() {\n  _getPermissionWithQueryAsync = _asyncToGenerator(function* (name) {\n    if (!navigator || !navigator.permissions || !navigator.permissions.query) return null;\n\n    var _yield$navigator$perm = yield navigator.permissions.query({\n      name: name\n    }),\n        state = _yield$navigator$perm.state;\n\n    if (state === 'prompt') {\n      return PermissionStatus.UNDETERMINED;\n    } else if (state === 'granted') {\n      return PermissionStatus.GRANTED;\n    } else if (state === 'denied') {\n      return PermissionStatus.DENIED;\n    }\n\n    return null;\n  });\n  return _getPermissionWithQueryAsync.apply(this, arguments);\n}\n\nfunction enumerateDevices() {\n  return _enumerateDevices.apply(this, arguments);\n}\n\nfunction _enumerateDevices() {\n  _enumerateDevices = _asyncToGenerator(function* () {\n    if (navigator && navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {\n      return yield navigator.mediaDevices.enumerateDevices();\n    }\n\n    if (window.MediaStreamTrack && typeof window.MediaStreamTrack.getSources === 'function') {\n      return yield MediaStreamTrack.getSources();\n    }\n\n    return null;\n  });\n  return _enumerateDevices.apply(this, arguments);\n}\n\nfunction askSensorPermissionAsync() {\n  return _askSensorPermissionAsync.apply(this, arguments);\n}\n\nfunction _askSensorPermissionAsync() {\n  _askSensorPermissionAsync = _asyncToGenerator(function* () {\n    var requestPermission = getRequestMotionPermission();\n    if (!requestPermission) return PermissionStatus.GRANTED;\n    var status = yield requestPermission();\n\n    switch (status) {\n      case 'granted':\n        return PermissionStatus.GRANTED;\n\n      case 'denied':\n        return PermissionStatus.DENIED;\n\n      default:\n        return PermissionStatus.UNDETERMINED;\n    }\n  });\n  return _askSensorPermissionAsync.apply(this, arguments);\n}\n\nfunction getMediaMaybeGrantedAsync(_x3) {\n  return _getMediaMaybeGrantedAsync.apply(this, arguments);\n}\n\nfunction _getMediaMaybeGrantedAsync() {\n  _getMediaMaybeGrantedAsync = _asyncToGenerator(function* (targetKind) {\n    var devices = yield enumerateDevices();\n\n    if (!devices) {\n      return false;\n    }\n\n    var result = yield devices.filter(function (_ref3) {\n      var kind = _ref3.kind;\n      return kind === targetKind;\n    }).some(function (_ref4) {\n      var label = _ref4.label;\n      return label !== '';\n    });\n    return result;\n  });\n  return _getMediaMaybeGrantedAsync.apply(this, arguments);\n}\n\nfunction getPermissionAsync(_x4, _x5) {\n  return _getPermissionAsync.apply(this, arguments);\n}\n\nfunction _getPermissionAsync() {\n  _getPermissionAsync = _asyncToGenerator(function* (permission, shouldAsk) {\n    switch (permission) {\n      case 'userFacingNotifications':\n      case 'notifications':\n        {\n          if (!shouldAsk) {\n            var status = yield getPermissionWithQueryAsync('notifications');\n\n            if (status) {\n              return {\n                status: status,\n                expires: 'never',\n                granted: status === PermissionStatus.GRANTED,\n                canAskAgain: true\n              };\n            }\n          }\n\n          var _window = window,\n              _window$Notification = _window.Notification,\n              Notification = _window$Notification === void 0 ? {} : _window$Notification;\n\n          if (Notification.requestPermission) {\n            var _status = Notification.permission;\n\n            if (shouldAsk) {\n              _status = yield Notification.requestPermission();\n            }\n\n            if (!_status || _status === 'default') {\n              return {\n                status: PermissionStatus.UNDETERMINED,\n                expires: 'never',\n                canAskAgain: true,\n                granted: false\n              };\n            }\n\n            return {\n              status: _status,\n              expires: 'never',\n              canAskAgain: true,\n              granted: _status === PermissionStatus.GRANTED\n            };\n          }\n        }\n        break;\n\n      case 'motion':\n        {\n          if (shouldAsk) {\n            var _status3 = yield askSensorPermissionAsync();\n\n            return {\n              status: _status3,\n              expires: 'never',\n              granted: _status3 === PermissionStatus.GRANTED,\n              canAskAgain: false\n            };\n          }\n\n          var _status2 = getRequestMotionPermission() ? PermissionStatus.UNDETERMINED : isIOS() ? PermissionStatus.DENIED : PermissionStatus.GRANTED;\n\n          return {\n            status: _status2,\n            expires: 'never',\n            canAskAgain: true,\n            granted: _status2 === PermissionStatus.GRANTED\n          };\n        }\n\n      case 'location':\n      case 'locationForeground':\n      case 'locationBackground':\n        {\n          var maybeStatus = yield getPermissionWithQueryAsync('geolocation');\n\n          if (maybeStatus) {\n            if (maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk) {\n              return yield askForLocationPermissionAsync();\n            }\n\n            return {\n              status: maybeStatus,\n              expires: 'never',\n              canAskAgain: true,\n              granted: maybeStatus === PermissionStatus.GRANTED\n            };\n          } else if (shouldAsk) {\n            return yield askForLocationPermissionAsync();\n          }\n        }\n        break;\n\n      case 'audioRecording':\n        {\n          var _maybeStatus = yield getPermissionWithQueryAsync('microphone');\n\n          if (_maybeStatus) {\n            if (_maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk) {\n              return yield askForMicrophonePermissionAsync();\n            }\n\n            return {\n              status: _maybeStatus,\n              expires: 'never',\n              canAskAgain: true,\n              granted: _maybeStatus === PermissionStatus.GRANTED\n            };\n          } else if (shouldAsk) {\n            return yield askForMicrophonePermissionAsync();\n          } else {\n            var maybeGranted = yield getMediaMaybeGrantedAsync('audioinput');\n\n            if (maybeGranted) {\n              return {\n                status: PermissionStatus.GRANTED,\n                expires: 'never',\n                canAskAgain: true,\n                granted: true\n              };\n            }\n          }\n        }\n        break;\n\n      case 'camera':\n        {\n          var _maybeStatus2 = yield getPermissionWithQueryAsync('camera');\n\n          if (_maybeStatus2) {\n            if (_maybeStatus2 === PermissionStatus.UNDETERMINED && shouldAsk) {\n              return yield askForCameraPermissionAsync();\n            }\n\n            return {\n              status: _maybeStatus2,\n              expires: 'never',\n              canAskAgain: true,\n              granted: _maybeStatus2 === PermissionStatus.GRANTED\n            };\n          } else if (shouldAsk) {\n            return yield askForCameraPermissionAsync();\n          } else {\n            var _maybeGranted = yield getMediaMaybeGrantedAsync('videoinput');\n\n            if (_maybeGranted) {\n              return {\n                status: PermissionStatus.GRANTED,\n                expires: 'never',\n                canAskAgain: true,\n                granted: true\n              };\n            }\n          }\n        }\n        break;\n\n      default:\n        break;\n    }\n\n    return {\n      status: PermissionStatus.UNDETERMINED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: false\n    };\n  });\n  return _getPermissionAsync.apply(this, arguments);\n}\n\nexport default {\n  get name() {\n    return 'ExpoPermissions';\n  },\n\n  getAsync: function () {\n    var _getAsync = _asyncToGenerator(function* (permissionTypes) {\n      var results = {};\n\n      for (var permissionType of new Set(permissionTypes)) {\n        results[permissionType] = yield getPermissionAsync(permissionType, false);\n      }\n\n      return results;\n    });\n\n    function getAsync(_x6) {\n      return _getAsync.apply(this, arguments);\n    }\n\n    return getAsync;\n  }(),\n  askAsync: function () {\n    var _askAsync = _asyncToGenerator(function* (permissionTypes) {\n      var results = {};\n\n      for (var permissionType of new Set(permissionTypes)) {\n        results[permissionType] = yield getPermissionAsync(permissionType, true);\n      }\n\n      return results;\n    });\n\n    function askAsync(_x7) {\n      return _askAsync.apply(this, arguments);\n    }\n\n    return askAsync;\n  }()\n};\nexport function getRequestMotionPermission() {\n  var _DeviceMotionEvent;\n\n  if (typeof DeviceMotionEvent !== 'undefined' && !!((_DeviceMotionEvent = DeviceMotionEvent) != null && _DeviceMotionEvent.requestPermission)) {\n    return DeviceMotionEvent.requestPermission;\n  }\n\n  return null;\n}\n\nfunction isIOS() {\n  var isIOSUA = /(iPad|iPhone|iPod)/g.test(navigator.userAgent);\n  var isIE11 = !!window['MSStream'];\n  return isIOSUA && !isIE11;\n}","map":{"version":3,"mappings":"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","names":["PermissionStatus","_getUserMedia","constraints","navigator","mediaDevices","getUserMedia","webkitGetUserMedia","mozGetUserMedia","error","Error","code","name","Promise","resolve","reject","call","askForMediaPermissionAsync","options","status","GRANTED","expires","canAskAgain","granted","message","UNDETERMINED","DENIED","askForMicrophonePermissionAsync","audio","askForCameraPermissionAsync","video","askForLocationPermissionAsync","geolocation","getCurrentPosition","getPermissionWithQueryAsync","permissions","query","state","enumerateDevices","window","MediaStreamTrack","getSources","askSensorPermissionAsync","requestPermission","getRequestMotionPermission","getMediaMaybeGrantedAsync","targetKind","devices","result","filter","kind","some","label","getPermissionAsync","permission","shouldAsk","Notification","isIOS","maybeStatus","maybeGranted","getAsync","permissionTypes","results","permissionType","Set","askAsync","DeviceMotionEvent","isIOSUA","test","userAgent","isIE11"],"sourceRoot":"","sources":["../src/ExpoPermissions.web.ts"],"sourcesContent":["import {\n  PermissionMap,\n  PermissionType,\n  PermissionStatus,\n  PermissionInfo,\n} from './Permissions.types';\n\n/*\n * TODO: Bacon: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Permissions\n * Add messages to manifest like we do with iOS info.plist\n */\n\n// https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#Using_the_new_API_in_older_browsers\n// Older browsers might not implement mediaDevices at all, so we set an empty object first\nfunction _getUserMedia(constraints: MediaStreamConstraints): Promise<MediaStream> {\n  if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n    return navigator.mediaDevices.getUserMedia(constraints);\n  }\n\n  // Some browsers partially implement mediaDevices. We can't just assign an object\n  // with getUserMedia as it would overwrite existing properties.\n  // Here, we will just add the getUserMedia property if it's missing.\n\n  // First get ahold of the legacy getUserMedia, if present\n  const getUserMedia =\n    // TODO: this method is deprecated, migrate to https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia\n    navigator.getUserMedia ||\n    navigator.webkitGetUserMedia ||\n    navigator.mozGetUserMedia ||\n    function () {\n      const error: any = new Error('Permission unimplemented');\n      error.code = 0;\n      error.name = 'NotAllowedError';\n      throw error;\n    };\n\n  return new Promise((resolve, reject) => {\n    getUserMedia.call(navigator, constraints, resolve, reject);\n  });\n}\n\nasync function askForMediaPermissionAsync(\n  options: MediaStreamConstraints\n): Promise<PermissionInfo> {\n  try {\n    await _getUserMedia(options);\n    return {\n      status: PermissionStatus.GRANTED,\n      expires: 'never',\n      canAskAgain: true,\n      granted: true,\n    };\n  } catch ({ message }) {\n    // name: NotAllowedError\n    // code: 0\n    if (message === 'Permission dismissed') {\n      // message: Permission dismissed\n      return {\n        status: PermissionStatus.UNDETERMINED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: false,\n      };\n    } else {\n      // TODO: Bacon: [OSX] The system could deny access to chrome.\n      // TODO: Bacon: add: { status: 'unimplemented' }\n      // message: Permission denied\n      return {\n        status: PermissionStatus.DENIED,\n        expires: 'never',\n        canAskAgain: true,\n        granted: false,\n      };\n    }\n  }\n}\n\nasync function askForMicrophonePermissionAsync(): Promise<PermissionInfo> {\n  return await askForMediaPermissionAsync({ audio: true });\n}\n\nasync function askForCameraPermissionAsync(): Promise<PermissionInfo> {\n  return await askForMediaPermissionAsync({ video: true });\n}\n\nasync function askForLocationPermissionAsync(): Promise<PermissionInfo> {\n  return new Promise((resolve) => {\n    navigator.geolocation.getCurrentPosition(\n      () =>\n        resolve({\n          status: PermissionStatus.GRANTED,\n          expires: 'never',\n          canAskAgain: true,\n          granted: true,\n        }),\n      ({ code }: GeolocationPositionError) => {\n        // https://developer.mozilla.org/en-US/docs/Web/API/PositionError/code\n        if (code === 1) {\n          resolve({\n            status: PermissionStatus.DENIED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false,\n          });\n        } else {\n          resolve({\n            status: PermissionStatus.UNDETERMINED,\n            expires: 'never',\n            canAskAgain: true,\n            granted: false,\n          });\n        }\n      }\n    );\n  });\n}\n\nasync function getPermissionWithQueryAsync(\n  name: PermissionNameWithAdditionalValues\n): Promise<PermissionStatus | null> {\n  if (!navigator || !navigator.permissions || !navigator.permissions.query) return null;\n\n  const { state } = await navigator.permissions.query({ name });\n  if (state === 'prompt') {\n    return PermissionStatus.UNDETERMINED;\n  } else if (state === 'granted') {\n    return PermissionStatus.GRANTED;\n  } else if (state === 'denied') {\n    return PermissionStatus.DENIED;\n  }\n  return null;\n}\n\nasync function enumerateDevices(): Promise<MediaDeviceInfo[] | null> {\n  if (navigator && navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {\n    return await navigator.mediaDevices.enumerateDevices();\n  }\n\n  // @ts-ignore: This is deprecated but we should still attempt to use it.\n  if (window.MediaStreamTrack && typeof window.MediaStreamTrack.getSources === 'function') {\n    // @ts-ignore\n    return await MediaStreamTrack.getSources();\n  }\n  return null;\n}\n\nasync function askSensorPermissionAsync(): Promise<PermissionStatus> {\n  const requestPermission = getRequestMotionPermission();\n  // Technically this is incorrect because it doesn't account for iOS 12.2 Safari.\n  // But unfortunately we can only abstract so much.\n  if (!requestPermission) return PermissionStatus.GRANTED;\n\n  // If this isn't invoked in a touch-event then it never resolves.\n  // Safari probably should throw an error but because it doesn't we have no way of informing the developer.\n  const status = await requestPermission();\n  switch (status) {\n    case 'granted':\n      return PermissionStatus.GRANTED;\n    case 'denied':\n      return PermissionStatus.DENIED;\n    default:\n      return PermissionStatus.UNDETERMINED;\n  }\n}\n\nasync function getMediaMaybeGrantedAsync(targetKind: MediaDeviceKind): Promise<boolean> {\n  const devices = await enumerateDevices();\n  if (!devices) {\n    return false;\n  }\n  const result = await devices\n    .filter(({ kind }) => kind === targetKind)\n    .some(({ label }) => label !== '');\n  // Granted or denied or undetermined or no devices\n  return result;\n}\n\nasync function getPermissionAsync(\n  permission: PermissionType,\n  shouldAsk: boolean\n): Promise<PermissionInfo> {\n  switch (permission) {\n    case 'userFacingNotifications':\n    case 'notifications':\n      {\n        if (!shouldAsk) {\n          const status = await getPermissionWithQueryAsync('notifications');\n          if (status) {\n            return {\n              status,\n              expires: 'never',\n              granted: status === PermissionStatus.GRANTED,\n              canAskAgain: true,\n            };\n          }\n        }\n\n        const { Notification = {} } = window as any;\n        if (Notification.requestPermission) {\n          let status = Notification.permission;\n          if (shouldAsk) {\n            status = await Notification.requestPermission();\n          }\n          if (!status || status === 'default') {\n            return {\n              status: PermissionStatus.UNDETERMINED,\n              expires: 'never',\n              canAskAgain: true,\n              granted: false,\n            };\n          }\n          return {\n            status,\n            expires: 'never',\n            canAskAgain: true,\n            granted: status === PermissionStatus.GRANTED,\n          };\n        }\n      }\n      break;\n    case 'motion': {\n      if (shouldAsk) {\n        const status = await askSensorPermissionAsync();\n        return {\n          status,\n          expires: 'never',\n          granted: status === PermissionStatus.GRANTED,\n          canAskAgain: false,\n        };\n      }\n\n      // We can infer from the requestor if this is an older browser.\n      const status = getRequestMotionPermission()\n        ? PermissionStatus.UNDETERMINED\n        : isIOS()\n        ? PermissionStatus.DENIED\n        : PermissionStatus.GRANTED;\n      return {\n        status,\n        expires: 'never',\n        canAskAgain: true,\n        granted: status === PermissionStatus.GRANTED,\n      };\n    }\n    case 'location':\n    case 'locationForeground':\n    case 'locationBackground':\n      {\n        const maybeStatus = await getPermissionWithQueryAsync('geolocation');\n        if (maybeStatus) {\n          if (maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk) {\n            return await askForLocationPermissionAsync();\n          }\n          return {\n            status: maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: maybeStatus === PermissionStatus.GRANTED,\n          };\n        } else if (shouldAsk) {\n          // TODO: Bacon: should this function as ask async when not in chrome?\n          return await askForLocationPermissionAsync();\n        }\n      }\n      break;\n    case 'audioRecording':\n      {\n        const maybeStatus = await getPermissionWithQueryAsync('microphone');\n        if (maybeStatus) {\n          if (maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk) {\n            return await askForMicrophonePermissionAsync();\n          }\n          return {\n            status: maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: maybeStatus === PermissionStatus.GRANTED,\n          };\n        } else if (shouldAsk) {\n          return await askForMicrophonePermissionAsync();\n        } else {\n          const maybeGranted = await getMediaMaybeGrantedAsync('audioinput');\n          if (maybeGranted) {\n            return {\n              status: PermissionStatus.GRANTED,\n              expires: 'never',\n              canAskAgain: true,\n              granted: true,\n            };\n          }\n          // TODO: Bacon: Get denied or undetermined...\n        }\n      }\n      break;\n    case 'camera':\n      {\n        const maybeStatus = await getPermissionWithQueryAsync('camera');\n        if (maybeStatus) {\n          if (maybeStatus === PermissionStatus.UNDETERMINED && shouldAsk) {\n            return await askForCameraPermissionAsync();\n          }\n          return {\n            status: maybeStatus,\n            expires: 'never',\n            canAskAgain: true,\n            granted: maybeStatus === PermissionStatus.GRANTED,\n          };\n        } else if (shouldAsk) {\n          return await askForCameraPermissionAsync();\n        } else {\n          const maybeGranted = await getMediaMaybeGrantedAsync('videoinput');\n          if (maybeGranted) {\n            return {\n              status: PermissionStatus.GRANTED,\n              expires: 'never',\n              canAskAgain: true,\n              granted: true,\n            };\n          }\n          // TODO: Bacon: Get denied or undetermined...\n        }\n      }\n      break;\n    default:\n      break;\n  }\n  return {\n    status: PermissionStatus.UNDETERMINED,\n    expires: 'never',\n    canAskAgain: true,\n    granted: false,\n  };\n}\n\nexport default {\n  get name(): string {\n    return 'ExpoPermissions';\n  },\n\n  async getAsync(permissionTypes: PermissionType[]): Promise<PermissionMap> {\n    const results = {};\n    for (const permissionType of new Set(permissionTypes)) {\n      results[permissionType] = await getPermissionAsync(permissionType, /* shouldAsk */ false);\n    }\n    return results;\n  },\n\n  async askAsync(permissionTypes: PermissionType[]): Promise<PermissionMap> {\n    const results = {};\n    for (const permissionType of new Set(permissionTypes)) {\n      results[permissionType] = await getPermissionAsync(permissionType, /* shouldAsk */ true);\n    }\n    return results;\n  },\n};\n\n/**\n * Temporary solution until `tslib.d.ts` is updated to include the new DeviceMotion API.\n * `typescript@4.4.4` is missing `requestPermission` described in https://w3c.github.io/deviceorientation/#devicemotion\n * MDN docs do not describe this property as well https://developer.mozilla.org/en-US/docs/Web/API/DeviceMotionEvent\n */\ndeclare let DeviceMotionEvent: {\n  prototype: DeviceMotionEvent;\n  new (type: string, eventInitDict?: DeviceMotionEventInit): DeviceMotionEvent;\n  requestPermission?: () => Promise<PermissionState>;\n};\n\nexport function getRequestMotionPermission(): (() => Promise<PermissionState>) | null {\n  if (typeof DeviceMotionEvent !== 'undefined' && !!DeviceMotionEvent?.requestPermission) {\n    return DeviceMotionEvent.requestPermission;\n  }\n\n  return null;\n}\n\n// https://stackoverflow.com/a/9039885/4047926\nfunction isIOS(): boolean {\n  const isIOSUA = /(iPad|iPhone|iPod)/g.test(navigator.userAgent);\n  const isIE11 = !!window['MSStream'];\n  return isIOSUA && !isIE11;\n}\n"]},"metadata":{},"sourceType":"module"}